###############################################################################
# SARIBLOG - Tests API REST Client
# Fichier : Back/tests/api.http
###############################################################################
# üìù NOTES D'UTILISATION
###############################################################################
#
# üöÄ D√âMARRAGE
# 1. Installer l'extension REST Client (par Huachao Mao) dans VS Code
# 2. D√©marrer le serveur : npm run dev (dans Back/)
# 3. Cliquer sur "Send Request" au-dessus de chaque requ√™te
#    (ou Ctrl+Alt+R / Cmd+Alt+R avec le curseur sur la requ√™te)
#
# üîê AUTHENTIFICATION (pour tester les routes admin et /users/me)
# 1. Aller √† la section "AUTH" ci-dessous (ligne ~44)
# 2. Dans la requ√™te "POST {{baseUrl}}/auth/login", remplacer les identifiants par les v√¥tres
# 3. Cliquer sur "Send Request" pour vous connecter
# 4. Dans la r√©ponse, copier la valeur de "accessToken"
# 5. La coller dans la variable @accessToken (ligne ~34)
# 6. Les routes admin fonctionneront automatiquement avec ce token
#
# üìä CODES HTTP COURANTS
# - 200 = Succ√®s
# - 401 = Non authentifi√© (token manquant/invalide)
# - 403 = Non autoris√© (r√¥le insuffisant)
# - 404 = Ressource introuvable
#
###############################################################################

### Variables globales
@baseUrl = http://localhost:4242/api
@adminUrl = http://localhost:4242/api/admin
# Apr√®s login, copier l'accessToken ici pour tester les routes admin et /users/me
@accessToken = votre_access_token_ici

###############################################################################
# üè† TEST SERVEUR
###############################################################################

### V√©rifier que le serveur tourne
GET http://localhost:4242/

###############################################################################
# üîê AUTH (login, signup, refresh, logout)
###############################################################################

### 1. Connexion (login) - r√©cup√®re accessToken + user, d√©finit cookie refreshToken
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "identifier": "admin@example.com",
  "password": "votre_mot_de_passe"
}

### 2. Inscription (signup)
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "username": "nouveau_user",
  "email": "nouveau@example.com",
  "password": "MotDePasse123!",
  "firstname": "Jean",
  "lastname": "Dupont"
}

### 3. Rafra√Æchir l'access token (utilise le cookie refreshToken)
POST {{baseUrl}}/auth/refresh

### 4. D√©connexion (logout) - invalide le refresh token et supprime le cookie
POST {{baseUrl}}/auth/logout

###############################################################################
# üì∞ ARTICLES (public)
###############################################################################

### 1. Preview homepage (4 derniers articles publi√©s)
GET {{baseUrl}}/articles/homepage-preview

### 2. Liste articles PUBLI√âS uniquement (public)
GET {{baseUrl}}/articles/published

### 3. Liste articles PUBLI√âS avec limite (public - max 20)
GET {{baseUrl}}/articles/published?limit=4

### 4. Article publi√© par ID (public)
GET {{baseUrl}}/articles/published/id/1

### 5. Article publi√© par SLUG (public)
GET {{baseUrl}}/articles/published/slug/tutoriel-peindre-dragon

###############################################################################
# üì∞ ARTICLES ADMIN (authentification requise : Authorization Bearer)
###############################################################################

### 1. Liste TOUS les articles (admin - tous statuts)
GET {{adminUrl}}/articles
Authorization: Bearer {{accessToken}}

### 2. Article par SLUG (admin)
GET {{adminUrl}}/articles/slug/decouvrir-aquarelle-guide-debutants
Authorization: Bearer {{accessToken}}

### 3. Article par ID (admin - d√©tails complets)
GET {{adminUrl}}/articles/1
Authorization: Bearer {{accessToken}}

### 4. Cr√©er un article (POST - admin)
POST {{adminUrl}}/articles
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "title": "Nouvel article",
  "slug": "nouvel-article",
  "content": "Contenu de l'article...",
  "status": "draft",
  "featured_image_id": 1
}

### 5. Modifier un article (PATCH - admin)
PATCH {{adminUrl}}/articles/1
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "title": "Titre modifi√©",
  "status": "published"
}

### 6. Supprimer un article (DELETE - admin)
DELETE {{adminUrl}}/articles/1
Authorization: Bearer {{accessToken}}

###############################################################################
# üñºÔ∏è IMAGES (public)
###############################################################################

### 1. Image du jour
GET {{baseUrl}}/images/image-of-the-day

### 2. Images de la GALERIE (is_in_gallery = TRUE)
GET {{baseUrl}}/images/gallery

### 3. Images d'un ARTICLE sp√©cifique
GET {{baseUrl}}/images/article/1

### 4. Images par TAG
GET {{baseUrl}}/images/tag/1

### 5. Image par ID
GET {{baseUrl}}/images/1

###############################################################################
# üë• USERS (public + 1 route prot√©g√©e)
###############################################################################

### 1. Liste tous les utilisateurs (public)
GET {{baseUrl}}/users

### 2. Artiste principale (public)
GET {{baseUrl}}/users/artist

### 3. Utilisateur connect√© (prot√©g√© - n√©cessite Bearer token)
GET {{baseUrl}}/users/me
Authorization: Bearer {{accessToken}}

### 4. Utilisateur par ID (public)
GET {{baseUrl}}/users/1

###############################################################################
# üè∑Ô∏è TAGS (public)
###############################################################################

### 1. Liste tous les tags
GET {{baseUrl}}/tags

### 2. Tags d'un article
GET {{baseUrl}}/tags/article/1

### 3. Tags d'une image
GET {{baseUrl}}/tags/image/1

###############################################################################
# üí¨ COMMENTS (public)
###############################################################################

### Commentaires approuv√©s d'un article
GET {{baseUrl}}/comments/article/1

###############################################################################
# üìß MESSAGES (public : POST uniquement)
###############################################################################

### Cr√©er un message de contact (POST - public)
POST {{baseUrl}}/messages
Content-Type: application/json

{
  "firstname": "John",
  "lastname": "Doe",
  "email": "john@example.com",
  "subject": "Question sur votre art",
  "text": "Bonjour, j'aimerais en savoir plus sur vos techniques..."
}

###############################################################################
# üìß MESSAGES ADMIN (authentification requise : Authorization Bearer)
###############################################################################

### 1. Liste tous les messages (GET - admin)
GET {{adminUrl}}/messages
Authorization: Bearer {{accessToken}}

### 2. Messages par statut : non lus (GET - admin)
GET {{adminUrl}}/messages/status/unread
Authorization: Bearer {{accessToken}}

### 3. Messages par statut : lus (GET - admin)
GET {{adminUrl}}/messages/status/read
Authorization: Bearer {{accessToken}}

### 4. Messages par statut : archiv√©s (GET - admin)
GET {{adminUrl}}/messages/status/archived
Authorization: Bearer {{accessToken}}

### 5. Message par ID (GET - admin)
GET {{adminUrl}}/messages/1
Authorization: Bearer {{accessToken}}

### 6. Mettre √† jour le statut d'un message (PATCH - admin)
PATCH {{adminUrl}}/messages/1/status
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "status": "read"
}

### 7. Supprimer un message (DELETE - admin)
DELETE {{adminUrl}}/messages/1
Authorization: Bearer {{accessToken}}

###############################################################################
# üß™ TESTS D'ERREURS
###############################################################################

### Article publi√© par ID inexistant (devrait retourner 404)
GET {{baseUrl}}/articles/published/id/99999

### Article publi√© par slug inexistant (devrait retourner 404)
GET {{baseUrl}}/articles/published/slug/article-qui-nexiste-pas

### Articles publi√©s avec limite invalide > 20 (devrait retourner 400)
GET {{baseUrl}}/articles/published?limit=25

### Articles publi√©s avec limite n√©gative (devrait retourner 400)
GET {{baseUrl}}/articles/published?limit=-1

### Image inexistante (devrait retourner 404)
GET {{baseUrl}}/images/99999

### Article inexistant pour images (devrait retourner tableau vide)
GET {{baseUrl}}/images/article/99999

### Tag inexistant pour images (devrait retourner tableau vide)
GET {{baseUrl}}/images/tag/99999

### User inexistant (devrait retourner 404)
GET {{baseUrl}}/users/99999

### Article inexistant pour tags (devrait retourner tableau vide)
GET {{baseUrl}}/tags/article/99999

### Image inexistante pour tags (devrait retourner tableau vide)
GET {{baseUrl}}/tags/image/99999

### Article inexistant pour commentaires (devrait retourner tableau vide)
GET {{baseUrl}}/comments/article/99999

### Message inexistant (devrait retourner 404)
GET {{adminUrl}}/messages/99999
Authorization: Bearer {{accessToken}}

### Messages par statut invalide (devrait retourner 400)
GET {{adminUrl}}/messages/status/invalid
Authorization: Bearer {{accessToken}}

### Mettre √† jour message avec statut invalide (devrait retourner 400)
PATCH {{adminUrl}}/messages/1/status
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "status": "invalid"
}

### Cr√©er message avec champs manquants (devrait retourner 400)
POST {{baseUrl}}/messages
Content-Type: application/json

{
  "firstname": "John"
}

### Route admin sans token (devrait retourner 401)
GET {{adminUrl}}/articles
# Pas de header Authorization
